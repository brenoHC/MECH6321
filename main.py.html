<html>
<head>
<title>main.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #7a7e85;}
.s4 { color: #2aacb8;}
.s5 { color: #6aab73;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
main.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">pyplot </span><span class="s0">as </span><span class="s1">plt</span>

<span class="s3"># Truss properties</span>
<span class="s1">E </span><span class="s2">= </span><span class="s4">1e4       </span><span class="s3"># Young's modulus</span>
<span class="s1">p </span><span class="s2">= </span><span class="s4">0.1111    </span><span class="s3"># Material Density</span>
<span class="s1">s_lim </span><span class="s2">= </span><span class="s4">25    </span><span class="s3"># Stress Limit (ksi)</span>
<span class="s3"># d_lim = 2   # Displacement Limit</span>

<span class="s3"># array node &amp; bar locations from 0 to 7 by 0 to 360 respectability</span>
<span class="s1">nodes </span><span class="s2">= []</span>
<span class="s1">bars </span><span class="s2">= []</span>

<span class="s1">nodes</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">120</span><span class="s2">])</span>
<span class="s1">nodes</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s4">120</span><span class="s2">, </span><span class="s4">120</span><span class="s2">])</span>
<span class="s1">nodes</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s4">240</span><span class="s2">, </span><span class="s4">120</span><span class="s2">])</span>
<span class="s1">nodes</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s4">360</span><span class="s2">, </span><span class="s4">120</span><span class="s2">])</span>
<span class="s1">nodes</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">])</span>
<span class="s1">nodes</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s4">120</span><span class="s2">, </span><span class="s4">0</span><span class="s2">])</span>
<span class="s1">nodes</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s4">240</span><span class="s2">, </span><span class="s4">0</span><span class="s2">])</span>
<span class="s1">nodes</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s4">360</span><span class="s2">, </span><span class="s4">0</span><span class="s2">])</span>

<span class="s1">bars</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">])</span>
<span class="s1">bars</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">])</span>
<span class="s1">bars</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">])</span>
<span class="s1">bars</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">])</span>
<span class="s1">bars</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s2">])</span>
<span class="s1">bars</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s4">6</span><span class="s2">, </span><span class="s4">7</span><span class="s2">])</span>

<span class="s1">bars</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s4">5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">])</span>
<span class="s1">bars</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s4">6</span><span class="s2">, </span><span class="s4">2</span><span class="s2">])</span>
<span class="s1">bars</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s4">7</span><span class="s2">, </span><span class="s4">3</span><span class="s2">])</span>

<span class="s1">bars</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">5</span><span class="s2">])</span>
<span class="s1">bars</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s4">4</span><span class="s2">, </span><span class="s4">1</span><span class="s2">])</span>
<span class="s1">bars</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">6</span><span class="s2">])</span>
<span class="s1">bars</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s4">5</span><span class="s2">, </span><span class="s4">2</span><span class="s2">])</span>
<span class="s1">bars</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s4">2</span><span class="s2">, </span><span class="s4">7</span><span class="s2">])</span>
<span class="s1">bars</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s4">6</span><span class="s2">, </span><span class="s4">3</span><span class="s2">])</span>

<span class="s1">nodes </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">nodes</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">float</span><span class="s2">)</span>
<span class="s1">bars </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">bars</span><span class="s2">)</span>

<span class="s1">nodes_original </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">(</span><span class="s1">nodes</span><span class="s2">)</span>

<span class="s3"># Force applied in  (kips)</span>
<span class="s1">P </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros_like</span><span class="s2">(</span><span class="s1">nodes</span><span class="s2">)</span>
<span class="s1">P</span><span class="s2">[</span><span class="s4">7</span><span class="s2">, </span><span class="s4">1</span><span class="s2">] = -</span><span class="s4">10</span>

<span class="s3"># Support Displacement</span>
<span class="s1">Ur </span><span class="s2">= [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]</span>

<span class="s3"># Condition of degree of freedom (1 = free, 0 = fixed)</span>
<span class="s1">DOFCON </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones_like</span><span class="s2">(</span><span class="s1">nodes</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">int</span><span class="s2">)</span>
<span class="s1">DOFCON</span><span class="s2">[</span><span class="s4">0</span><span class="s2">, :] = </span><span class="s4">0</span>
<span class="s1">DOFCON</span><span class="s2">[</span><span class="s4">4</span><span class="s2">, :] = </span><span class="s4">0</span>

<span class="s3"># Permissible area and geometry variables</span>
<span class="s1">Ai </span><span class="s2">= [</span><span class="s4">0.111</span><span class="s2">, </span><span class="s4">0.141</span><span class="s2">, </span><span class="s4">0.174</span><span class="s2">, </span><span class="s4">0.220</span><span class="s2">, </span><span class="s4">0.270</span><span class="s2">, </span><span class="s4">0.287</span><span class="s2">, </span><span class="s4">0.347</span><span class="s2">, </span><span class="s4">0.440</span><span class="s2">, </span><span class="s4">0.539</span><span class="s2">, </span><span class="s4">0.954</span><span class="s2">,</span>
      <span class="s4">1.081</span><span class="s2">, </span><span class="s4">1.174</span><span class="s2">, </span><span class="s4">1.333</span><span class="s2">, </span><span class="s4">1.488</span><span class="s2">, </span><span class="s4">1.764</span><span class="s2">, </span><span class="s4">2.142</span><span class="s2">, </span><span class="s4">2.697</span><span class="s2">, </span><span class="s4">2.800</span><span class="s2">, </span><span class="s4">3.131</span><span class="s2">, </span><span class="s4">3.565</span><span class="s2">,</span>
      <span class="s4">3.813</span><span class="s2">, </span><span class="s4">4.805</span><span class="s2">, </span><span class="s4">5.952</span><span class="s2">, </span><span class="s4">6.572</span><span class="s2">, </span><span class="s4">7.192</span><span class="s2">, </span><span class="s4">8.525</span><span class="s2">, </span><span class="s4">9.300</span><span class="s2">, </span><span class="s4">10.850</span><span class="s2">, </span><span class="s4">13.330</span><span class="s2">, </span><span class="s4">14.290</span><span class="s2">,</span>
      <span class="s4">17.170</span><span class="s2">, </span><span class="s4">19.180</span><span class="s2">]  </span><span class="s3"># Return evenly spaced numbers over a specified interval</span>
<span class="s1">A_index </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">len</span><span class="s2">(</span><span class="s1">Ai</span><span class="s2">) - </span><span class="s4">1</span><span class="s2">, </span><span class="s1">len</span><span class="s2">(</span><span class="s1">Ai</span><span class="s2">)).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">int</span><span class="s2">)</span>

<span class="s1">NC </span><span class="s2">= []  </span><span class="s3"># Node Conditions</span>
<span class="s1">NC</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s4">100</span><span class="s2">, </span><span class="s4">140</span><span class="s2">])  </span><span class="s3"># X2 [min, max]</span>
<span class="s1">NC</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s4">220</span><span class="s2">, </span><span class="s4">260</span><span class="s2">])  </span><span class="s3"># X3 [min, max]</span>
<span class="s1">NC</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s4">100</span><span class="s2">, </span><span class="s4">140</span><span class="s2">])  </span><span class="s3"># Y2 [min, max]</span>
<span class="s1">NC</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s4">100</span><span class="s2">, </span><span class="s4">140</span><span class="s2">])  </span><span class="s3"># Y3 [min, max]</span>
<span class="s1">NC</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s4">50</span><span class="s2">, </span><span class="s4">90</span><span class="s2">])    </span><span class="s3"># Y4 [min, max]</span>
<span class="s1">NC</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([-</span><span class="s4">20</span><span class="s2">, </span><span class="s4">20</span><span class="s2">])   </span><span class="s3"># Y6 [min, max]</span>
<span class="s1">NC</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([-</span><span class="s4">20</span><span class="s2">, </span><span class="s4">20</span><span class="s2">])   </span><span class="s3"># Y7 [min, max]</span>
<span class="s1">NC</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s4">20</span><span class="s2">, </span><span class="s4">60</span><span class="s2">])    </span><span class="s3"># Y8 [min, max]</span>
<span class="s1">NC </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">NC</span><span class="s2">)</span>


<span class="s3"># Assign geometry variable</span>
<span class="s0">def </span><span class="s1">AssignGeometry</span><span class="s2">(</span><span class="s1">Var</span><span class="s2">, </span><span class="s1">d</span><span class="s2">, </span><span class="s1">d1</span><span class="s2">): </span><span class="s3"># seeting the coordinates of the node, it will change at every iteration</span>
    <span class="s1">NCi </span><span class="s2">= </span><span class="s1">Var</span><span class="s2">[</span><span class="s1">d1</span><span class="s2">:</span><span class="s1">d</span><span class="s2">]  </span><span class="s3"># Node Conditions</span>

    <span class="s3"># Assign geometry variable</span>
    <span class="s1">nodes</span><span class="s2">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">] = </span><span class="s1">NCi</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]  </span><span class="s3"># Node 2 (Axis X)</span>
    <span class="s1">nodes</span><span class="s2">[</span><span class="s4">5</span><span class="s2">, </span><span class="s4">0</span><span class="s2">] = </span><span class="s1">NCi</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]  </span><span class="s3"># Node 6 (Axis X)</span>
    <span class="s1">nodes</span><span class="s2">[</span><span class="s4">2</span><span class="s2">, </span><span class="s4">0</span><span class="s2">] = </span><span class="s1">NCi</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]  </span><span class="s3"># Node 3 (Axis X)</span>
    <span class="s1">nodes</span><span class="s2">[</span><span class="s4">6</span><span class="s2">, </span><span class="s4">0</span><span class="s2">] = </span><span class="s1">NCi</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]  </span><span class="s3"># Node 7 (Axis X)</span>
    <span class="s1">nodes</span><span class="s2">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">] = </span><span class="s1">NCi</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]  </span><span class="s3"># Node 2 (Axis Y)</span>
    <span class="s1">nodes</span><span class="s2">[</span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">] = </span><span class="s1">NCi</span><span class="s2">[</span><span class="s4">3</span><span class="s2">]  </span><span class="s3"># Node 3 (Axis Y)</span>
    <span class="s1">nodes</span><span class="s2">[</span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s2">] = </span><span class="s1">NCi</span><span class="s2">[</span><span class="s4">4</span><span class="s2">]  </span><span class="s3"># Node 4 (Axis Y)</span>
    <span class="s1">nodes</span><span class="s2">[</span><span class="s4">5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">] = </span><span class="s1">NCi</span><span class="s2">[</span><span class="s4">5</span><span class="s2">]  </span><span class="s3"># Node 6 (Axis Y)</span>
    <span class="s1">nodes</span><span class="s2">[</span><span class="s4">6</span><span class="s2">, </span><span class="s4">1</span><span class="s2">] = </span><span class="s1">NCi</span><span class="s2">[</span><span class="s4">6</span><span class="s2">]  </span><span class="s3"># Node 7 (Axis Y)</span>
    <span class="s1">nodes</span><span class="s2">[</span><span class="s4">7</span><span class="s2">, </span><span class="s4">1</span><span class="s2">] = </span><span class="s1">NCi</span><span class="s2">[</span><span class="s4">7</span><span class="s2">]  </span><span class="s3"># Node 8 (Axis Y)</span>


<span class="s3"># %% Truss structure analysis</span>
<span class="s0">def </span><span class="s1">TrussAnalysis</span><span class="s2">(</span><span class="s1">Var</span><span class="s2">, </span><span class="s1">d</span><span class="s2">, </span><span class="s1">d1</span><span class="s2">):</span>
    <span class="s1">NN </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">nodes</span><span class="s2">)  </span><span class="s3"># Number of nodes</span>
    <span class="s1">NE </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">bars</span><span class="s2">)   </span><span class="s3"># Number of bars</span>
    <span class="s1">DOF </span><span class="s2">= </span><span class="s4">2          </span><span class="s3"># 2D Truss</span>
    <span class="s1">NDOF </span><span class="s2">= </span><span class="s1">DOF </span><span class="s2">* </span><span class="s1">NN  </span><span class="s3"># Total # of DoF</span>

    <span class="s1">A </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">(</span><span class="s1">Var</span><span class="s2">[</span><span class="s4">0</span><span class="s2">:</span><span class="s1">d1</span><span class="s2">])</span>
    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">NE</span><span class="s2">):</span>
        <span class="s1">A</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] = </span><span class="s1">Ai</span><span class="s2">[</span><span class="s1">Var</span><span class="s2">[</span><span class="s1">i</span><span class="s2">].</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">int</span><span class="s2">)]</span>
    <span class="s1">AssignGeometry</span><span class="s2">(</span><span class="s1">Var</span><span class="s2">, </span><span class="s1">d</span><span class="s2">, </span><span class="s1">d1</span><span class="s2">)</span>

    <span class="s3"># Structural analysis</span>
    <span class="s1">d </span><span class="s2">= </span><span class="s1">nodes</span><span class="s2">[</span><span class="s1">bars</span><span class="s2">[:, </span><span class="s4">1</span><span class="s2">], :] - </span><span class="s1">nodes</span><span class="s2">[</span><span class="s1">bars</span><span class="s2">[:, </span><span class="s4">0</span><span class="s2">], :]</span>
    <span class="s1">L </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">((</span><span class="s1">d </span><span class="s2">** </span><span class="s4">2</span><span class="s2">).</span><span class="s1">sum</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s4">1</span><span class="s2">))</span>
    <span class="s1">angle </span><span class="s2">= </span><span class="s1">d</span><span class="s2">.</span><span class="s1">T </span><span class="s2">/ </span><span class="s1">L</span>
    <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">concatenate</span><span class="s2">((-</span><span class="s1">angle</span><span class="s2">.</span><span class="s1">T</span><span class="s2">, </span><span class="s1">angle</span><span class="s2">.</span><span class="s1">T</span><span class="s2">), </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">K </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">([</span><span class="s1">NDOF</span><span class="s2">, </span><span class="s1">NDOF</span><span class="s2">])  </span><span class="s3"># Stiffness matrix</span>
    <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">NE</span><span class="s2">):</span>
        <span class="s3"># DOFs</span>
        <span class="s1">aux </span><span class="s2">= </span><span class="s4">2 </span><span class="s2">* </span><span class="s1">bars</span><span class="s2">[</span><span class="s1">k</span><span class="s2">, :]</span>
        <span class="s1">index </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">r_</span><span class="s2">[</span><span class="s1">aux</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]:</span><span class="s1">aux</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] + </span><span class="s4">2</span><span class="s2">, </span><span class="s1">aux</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]:</span><span class="s1">aux</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] + </span><span class="s4">2</span><span class="s2">]</span>
        <span class="s3"># Stiffness matrix</span>
        <span class="s1">ES </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">a</span><span class="s2">[</span><span class="s1">k</span><span class="s2">][</span><span class="s1">np</span><span class="s2">.</span><span class="s1">newaxis</span><span class="s2">].</span><span class="s1">T </span><span class="s2">* </span><span class="s1">E </span><span class="s2">* </span><span class="s1">A</span><span class="s2">[</span><span class="s1">k</span><span class="s2">], </span><span class="s1">a</span><span class="s2">[</span><span class="s1">k</span><span class="s2">][</span><span class="s1">np</span><span class="s2">.</span><span class="s1">newaxis</span><span class="s2">]) / </span><span class="s1">L</span><span class="s2">[</span><span class="s1">k</span><span class="s2">]</span>
        <span class="s1">K</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ix_</span><span class="s2">(</span><span class="s1">index</span><span class="s2">, </span><span class="s1">index</span><span class="s2">)] = </span><span class="s1">K</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ix_</span><span class="s2">(</span><span class="s1">index</span><span class="s2">, </span><span class="s1">index</span><span class="s2">)] + </span><span class="s1">ES</span>
    <span class="s1">freeDOF </span><span class="s2">= </span><span class="s1">DOFCON</span><span class="s2">.</span><span class="s1">flatten</span><span class="s2">().</span><span class="s1">nonzero</span><span class="s2">()[</span><span class="s4">0</span><span class="s2">]</span>
    <span class="s1">supportDOF </span><span class="s2">= (</span><span class="s1">DOFCON</span><span class="s2">.</span><span class="s1">flatten</span><span class="s2">() == </span><span class="s4">0</span><span class="s2">).</span><span class="s1">nonzero</span><span class="s2">()[</span><span class="s4">0</span><span class="s2">]</span>
    <span class="s1">Kff </span><span class="s2">= </span><span class="s1">K</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ix_</span><span class="s2">(</span><span class="s1">freeDOF</span><span class="s2">, </span><span class="s1">freeDOF</span><span class="s2">)]</span>
    <span class="s1">Pf </span><span class="s2">= </span><span class="s1">P</span><span class="s2">.</span><span class="s1">flatten</span><span class="s2">()[</span><span class="s1">freeDOF</span><span class="s2">]</span>
    <span class="s1">Uf </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linalg</span><span class="s2">.</span><span class="s1">solve</span><span class="s2">(</span><span class="s1">Kff</span><span class="s2">, </span><span class="s1">Pf</span><span class="s2">)</span>
    <span class="s1">U </span><span class="s2">= </span><span class="s1">DOFCON</span><span class="s2">.</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">float</span><span class="s2">).</span><span class="s1">flatten</span><span class="s2">()</span>
    <span class="s1">U</span><span class="s2">[</span><span class="s1">freeDOF</span><span class="s2">] = </span><span class="s1">Uf</span>
    <span class="s1">U</span><span class="s2">[</span><span class="s1">supportDOF</span><span class="s2">] = </span><span class="s1">Ur</span>
    <span class="s1">U </span><span class="s2">= </span><span class="s1">U</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">(</span><span class="s1">NN</span><span class="s2">, </span><span class="s1">DOF</span><span class="s2">)  </span><span class="s3"># Displacement (in)</span>
    <span class="s1">u </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">concatenate</span><span class="s2">((</span><span class="s1">U</span><span class="s2">[</span><span class="s1">bars</span><span class="s2">[:, </span><span class="s4">0</span><span class="s2">]], </span><span class="s1">U</span><span class="s2">[</span><span class="s1">bars</span><span class="s2">[:, </span><span class="s4">1</span><span class="s2">]]), </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">N </span><span class="s2">= </span><span class="s1">E </span><span class="s2">* </span><span class="s1">A</span><span class="s2">[:] / </span><span class="s1">L</span><span class="s2">[:] * (</span><span class="s1">a</span><span class="s2">[:] * </span><span class="s1">u</span><span class="s2">[:]).</span><span class="s1">sum</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)  </span><span class="s3"># Force (kips)</span>
    <span class="s1">S </span><span class="s2">= </span><span class="s1">N </span><span class="s2">/ </span><span class="s1">A</span>
    <span class="s1">Mass </span><span class="s2">= (</span><span class="s1">p </span><span class="s2">* </span><span class="s1">A </span><span class="s2">* </span><span class="s1">L</span><span class="s2">).</span><span class="s1">sum</span><span class="s2">()</span>
    <span class="s0">return </span><span class="s1">S</span><span class="s2">, </span><span class="s1">Mass</span>


<span class="s3">#  PROBLEM DEFINITION</span>
<span class="s1">d1 </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">bars</span><span class="s2">) </span><span class="s3">#</span>
<span class="s1">d2 </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">NC</span><span class="s2">)</span>
<span class="s1">d </span><span class="s2">= </span><span class="s1">d1 </span><span class="s2">+ </span><span class="s1">d2</span>

<span class="s3"># Lower and upper bound of search area</span>
<span class="s1">Xlim </span><span class="s2">= [</span><span class="s1">min</span><span class="s2">(</span><span class="s1">A_index</span><span class="s2">), </span><span class="s1">max</span><span class="s2">(</span><span class="s1">A_index</span><span class="s2">)] * </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">([</span><span class="s1">len</span><span class="s2">(</span><span class="s1">bars</span><span class="s2">), </span><span class="s4">2</span><span class="s2">])</span>
<span class="s1">Xlim </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">concatenate</span><span class="s2">([</span><span class="s1">Xlim</span><span class="s2">, </span><span class="s1">NC</span><span class="s2">], </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)</span>

<span class="s3"># Lower and upper bound of velocity</span>
<span class="s1">Vlim </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">([</span><span class="s1">d</span><span class="s2">, </span><span class="s4">2</span><span class="s2">])</span>
<span class="s1">Vlim</span><span class="s2">[:, </span><span class="s4">1</span><span class="s2">] = (</span><span class="s1">Xlim</span><span class="s2">[:, </span><span class="s4">1</span><span class="s2">] - </span><span class="s1">Xlim</span><span class="s2">[:, </span><span class="s4">0</span><span class="s2">]) * </span><span class="s4">0.2</span>
<span class="s1">Vlim</span><span class="s2">[:, </span><span class="s4">0</span><span class="s2">] = -</span><span class="s1">Vlim</span><span class="s2">[:, </span><span class="s4">1</span><span class="s2">]</span>

<span class="s1">MaxIt </span><span class="s2">= </span><span class="s4">500</span>
<span class="s1">ps </span><span class="s2">= </span><span class="s4">9  </span><span class="s3"># according to paper Shi and aberhart</span>
<span class="s1">c1 </span><span class="s2">= </span><span class="s4">2  </span><span class="s3"># according to paper Shi and aberhart</span>
<span class="s1">c2 </span><span class="s2">= </span><span class="s4">2  </span><span class="s3"># according to paper Shi and aberhart</span>
<span class="s1">w </span><span class="s2">= </span><span class="s4">0.9 </span><span class="s2">- ((</span><span class="s4">0.9 </span><span class="s2">- </span><span class="s4">0.4</span><span class="s2">) / </span><span class="s1">MaxIt</span><span class="s2">) * </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">MaxIt</span><span class="s2">, </span><span class="s1">MaxIt</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">limitV</span><span class="s2">(</span><span class="s1">V</span><span class="s2">, </span><span class="s1">d</span><span class="s2">):  </span><span class="s3"># defining limit of velocity</span>
    <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">d</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">V</span><span class="s2">[</span><span class="s1">j</span><span class="s2">] &gt; </span><span class="s1">Vlim</span><span class="s2">[</span><span class="s1">j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]:</span>
            <span class="s1">V</span><span class="s2">[</span><span class="s1">j</span><span class="s2">] = </span><span class="s1">Vlim</span><span class="s2">[</span><span class="s1">j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]</span>
        <span class="s0">if </span><span class="s1">V</span><span class="s2">[</span><span class="s1">j</span><span class="s2">] &lt; </span><span class="s1">Vlim</span><span class="s2">[</span><span class="s1">j</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]:</span>
            <span class="s1">V</span><span class="s2">[</span><span class="s1">j</span><span class="s2">] = </span><span class="s1">Vlim</span><span class="s2">[</span><span class="s1">j</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]</span>
    <span class="s0">return </span><span class="s1">V</span>


<span class="s0">def </span><span class="s1">Plot</span><span class="s2">(</span><span class="s1">nodes</span><span class="s2">, </span><span class="s1">X</span><span class="s2">, </span><span class="s1">D</span><span class="s2">, </span><span class="s1">D1</span><span class="s2">, </span><span class="s1">Assign</span><span class="s2">, </span><span class="s1">c</span><span class="s2">, </span><span class="s1">lt</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">, </span><span class="s1">lg</span><span class="s2">):</span>
    <span class="s0">if </span><span class="s1">Assign </span><span class="s2">== </span><span class="s4">1</span><span class="s2">:</span>
        <span class="s1">AssignGeometry</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">D</span><span class="s2">, </span><span class="s1">D1</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">D1</span><span class="s2">):</span>
        <span class="s1">xi</span><span class="s2">, </span><span class="s1">xf </span><span class="s2">= </span><span class="s1">nodes</span><span class="s2">[</span><span class="s1">bars</span><span class="s2">[</span><span class="s1">i</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], </span><span class="s4">0</span><span class="s2">], </span><span class="s1">nodes</span><span class="s2">[</span><span class="s1">bars</span><span class="s2">[</span><span class="s1">i</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], </span><span class="s4">0</span><span class="s2">]</span>
        <span class="s1">yi</span><span class="s2">, </span><span class="s1">yf </span><span class="s2">= </span><span class="s1">nodes</span><span class="s2">[</span><span class="s1">bars</span><span class="s2">[</span><span class="s1">i</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], </span><span class="s4">1</span><span class="s2">], </span><span class="s1">nodes</span><span class="s2">[</span><span class="s1">bars</span><span class="s2">[</span><span class="s1">i</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], </span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">line</span><span class="s2">, = </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s1">xi</span><span class="s2">, </span><span class="s1">xf</span><span class="s2">], [</span><span class="s1">yi</span><span class="s2">, </span><span class="s1">yf</span><span class="s2">], </span><span class="s1">color</span><span class="s2">=</span><span class="s1">c</span><span class="s2">, </span><span class="s1">linestyle</span><span class="s2">=</span><span class="s1">lt</span><span class="s2">, </span><span class="s1">linewidth</span><span class="s2">=</span><span class="s1">lw</span><span class="s2">)</span>
    <span class="s1">line</span><span class="s2">.</span><span class="s1">set_label</span><span class="s2">(</span><span class="s1">lg</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">prop</span><span class="s2">={</span><span class="s5">'size'</span><span class="s2">: </span><span class="s4">8</span><span class="s2">})</span>



<span class="s0">def </span><span class="s1">FindNearest</span><span class="s2">(</span><span class="s1">array</span><span class="s2">, </span><span class="s1">value</span><span class="s2">): </span><span class="s3"># finds integer</span>
    <span class="s1">array </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">asarray</span><span class="s2">(</span><span class="s1">array</span><span class="s2">)</span>
    <span class="s1">idx </span><span class="s2">= (</span><span class="s1">np</span><span class="s2">.</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">array </span><span class="s2">- </span><span class="s1">value</span><span class="s2">)).</span><span class="s1">argmin</span><span class="s2">()</span>
    <span class="s0">return </span><span class="s1">array</span><span class="s2">[</span><span class="s1">idx</span><span class="s2">]</span>


<span class="s3">#  PSO Algorithm</span>
<span class="s0">def </span><span class="s1">optimization</span><span class="s2">():</span>
    <span class="s0">class </span><span class="s1">Particle</span><span class="s2">:</span>
        <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">position </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">([</span><span class="s1">ps</span><span class="s2">, </span><span class="s1">d</span><span class="s2">])</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">velocity </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">([</span><span class="s1">ps</span><span class="s2">, </span><span class="s1">d</span><span class="s2">])</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">cost </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s1">ps</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">stress </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">([</span><span class="s1">ps</span><span class="s2">, </span><span class="s1">d1</span><span class="s2">])</span>
            <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">ps</span><span class="s2">):</span>
                <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">d</span><span class="s2">):</span>
                    <span class="s0">if </span><span class="s1">j </span><span class="s2">&lt; </span><span class="s1">d1</span><span class="s2">:</span>
                        <span class="s1">self</span><span class="s2">.</span><span class="s1">position</span><span class="s2">[</span><span class="s1">i</span><span class="s2">, </span><span class="s1">j</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">choice</span><span class="s2">(</span><span class="s1">A_index</span><span class="s2">[</span><span class="s1">A_index </span><span class="s2">&gt; </span><span class="s4">15</span><span class="s2">]) </span><span class="s3"># picks random value selected &gt; 15</span>
                    <span class="s0">else</span><span class="s2">:</span>
                        <span class="s1">self</span><span class="s2">.</span><span class="s1">position</span><span class="s2">[</span><span class="s1">i</span><span class="s2">, </span><span class="s1">j</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">uniform</span><span class="s2">(</span><span class="s1">Xlim</span><span class="s2">[</span><span class="s1">j</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], </span><span class="s1">Xlim</span><span class="s2">[</span><span class="s1">j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">])</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">velocity</span><span class="s2">[</span><span class="s1">i</span><span class="s2">, </span><span class="s1">j</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">uniform</span><span class="s2">(</span><span class="s1">Vlim</span><span class="s2">[</span><span class="s1">j</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], </span><span class="s1">Vlim</span><span class="s2">[</span><span class="s1">j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">])</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">stress</span><span class="s2">[</span><span class="s1">i</span><span class="s2">], </span><span class="s1">self</span><span class="s2">.</span><span class="s1">cost</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] = </span><span class="s1">TrussAnalysis</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">position</span><span class="s2">[</span><span class="s1">i</span><span class="s2">], </span><span class="s1">d</span><span class="s2">, </span><span class="s1">d1</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">pbest </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">position</span><span class="s2">) </span><span class="s3"># perosnal best for all varibles (used for initial calculations only)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">pbest_cost </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">cost</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">index </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">argmin</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">pbest_cost</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">gbest </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">pbest</span><span class="s2">[</span><span class="s1">self</span><span class="s2">.</span><span class="s1">index</span><span class="s2">]</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">gbest_cost </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">pbest_cost</span><span class="s2">[</span><span class="s1">self</span><span class="s2">.</span><span class="s1">index</span><span class="s2">]</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">BestCost </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s1">MaxIt</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">BestPosition </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">([</span><span class="s1">MaxIt</span><span class="s2">, </span><span class="s1">d</span><span class="s2">])</span>

        <span class="s0">def </span><span class="s1">Evaluate</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
            <span class="s0">for </span><span class="s1">it </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">MaxIt</span><span class="s2">):</span>
                <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">ps</span><span class="s2">):</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">velocity</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] = (</span><span class="s1">w</span><span class="s2">[</span><span class="s1">it</span><span class="s2">] * </span><span class="s1">self</span><span class="s2">.</span><span class="s1">velocity</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]</span>
                                        <span class="s2">+ </span><span class="s1">c1 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s1">d</span><span class="s2">) * (</span><span class="s1">self</span><span class="s2">.</span><span class="s1">pbest</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] - </span><span class="s1">self</span><span class="s2">.</span><span class="s1">position</span><span class="s2">[</span><span class="s1">i</span><span class="s2">])</span>
                                        <span class="s2">+ </span><span class="s1">c2 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s1">d</span><span class="s2">) * (</span><span class="s1">self</span><span class="s2">.</span><span class="s1">gbest </span><span class="s2">- </span><span class="s1">self</span><span class="s2">.</span><span class="s1">position</span><span class="s2">[</span><span class="s1">i</span><span class="s2">])) </span><span class="s3"># Velocity equation from paper</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">velocity</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] = </span><span class="s1">limitV</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">velocity</span><span class="s2">[</span><span class="s1">i</span><span class="s2">], </span><span class="s1">d</span><span class="s2">)</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">position</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">position</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] + </span><span class="s1">self</span><span class="s2">.</span><span class="s1">velocity</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] </span><span class="s3"># update position</span>
                    <span class="s0">for </span><span class="s1">p </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">d1</span><span class="s2">):</span>
                        <span class="s1">self</span><span class="s2">.</span><span class="s1">position</span><span class="s2">[</span><span class="s1">i</span><span class="s2">, </span><span class="s1">p</span><span class="s2">] = </span><span class="s1">FindNearest</span><span class="s2">(</span><span class="s1">A_index</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">position</span><span class="s2">[</span><span class="s1">i</span><span class="s2">, </span><span class="s1">p</span><span class="s2">])</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">stress</span><span class="s2">[</span><span class="s1">i</span><span class="s2">], </span><span class="s1">self</span><span class="s2">.</span><span class="s1">cost</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] = </span><span class="s1">TrussAnalysis</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">position</span><span class="s2">[</span><span class="s1">i</span><span class="s2">], </span><span class="s1">d</span><span class="s2">, </span><span class="s1">d1</span><span class="s2">)</span>

                    <span class="s1">C_total </span><span class="s2">= </span><span class="s4">0 </span><span class="s3"># Desing constrain(5) from farqad Jawad et al. controls stress from opt</span>
                    <span class="s0">for </span><span class="s1">cd </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">d1</span><span class="s2">):</span>
                        <span class="s0">if </span><span class="s1">np</span><span class="s2">.</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">stress</span><span class="s2">[</span><span class="s1">i</span><span class="s2">, </span><span class="s1">cd</span><span class="s2">]) &gt; </span><span class="s1">s_lim</span><span class="s2">:</span>
                            <span class="s1">C1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">abs</span><span class="s2">((</span><span class="s1">self</span><span class="s2">.</span><span class="s1">stress</span><span class="s2">[</span><span class="s1">i</span><span class="s2">, </span><span class="s1">cd</span><span class="s2">] - </span><span class="s1">s_lim</span><span class="s2">) / </span><span class="s1">s_lim</span><span class="s2">)</span>
                        <span class="s0">else</span><span class="s2">:</span>
                            <span class="s1">C1 </span><span class="s2">= </span><span class="s4">0</span>
                        <span class="s1">C_total </span><span class="s2">= </span><span class="s1">C_total </span><span class="s2">+ </span><span class="s1">C1</span>
                    <span class="s1">phi </span><span class="s2">= (</span><span class="s4">1 </span><span class="s2">+ </span><span class="s1">C_total</span><span class="s2">)</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">cost</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">cost</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] * </span><span class="s1">phi</span>
                    <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">cost</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] &lt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">pbest_cost</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]:</span>
                        <span class="s1">self</span><span class="s2">.</span><span class="s1">pbest</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">position</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]</span>
                        <span class="s1">self</span><span class="s2">.</span><span class="s1">pbest_cost</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">cost</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]</span>
                        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">pbest_cost</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] &lt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">gbest_cost</span><span class="s2">:</span>
                            <span class="s1">self</span><span class="s2">.</span><span class="s1">gbest </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">pbest</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]</span>
                            <span class="s1">self</span><span class="s2">.</span><span class="s1">gbest_cost </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">pbest_cost</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">BestCost</span><span class="s2">[</span><span class="s1">it</span><span class="s2">] = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">gbest_cost </span><span class="s3"># collects data</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">BestPosition</span><span class="s2">[</span><span class="s1">it</span><span class="s2">] = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">gbest</span>

        <span class="s0">def </span><span class="s1">Plot</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">precision</span><span class="s2">=</span><span class="s4">3</span><span class="s2">, </span><span class="s1">suppress</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s4">0</span><span class="s2">)</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">BestCost</span><span class="s2">)</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s5">'Design Variables'</span><span class="s2">)</span>
            <span class="s1">Design_var </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">position</span><span class="s2">[-</span><span class="s4">1</span><span class="s2">])</span>
            <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">d1</span><span class="s2">):</span>
                <span class="s1">Design_var</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] = </span><span class="s1">Ai</span><span class="s2">[</span><span class="s1">self</span><span class="s2">.</span><span class="s1">position</span><span class="s2">[-</span><span class="s4">1</span><span class="s2">, </span><span class="s1">i</span><span class="s2">].</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">int</span><span class="s2">)]</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s1">Design_var</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">newaxis</span><span class="s2">].</span><span class="s1">T</span><span class="s2">)</span>
            <span class="s1">Stress</span><span class="s2">, </span><span class="s1">Cost </span><span class="s2">= </span><span class="s1">TrussAnalysis</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">BestPosition</span><span class="s2">[-</span><span class="s4">1</span><span class="s2">], </span><span class="s1">d</span><span class="s2">, </span><span class="s1">d1</span><span class="s2">)</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s5">'Stress [ksi]'</span><span class="s2">)</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s1">Stress</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">newaxis</span><span class="s2">].</span><span class="s1">T</span><span class="s2">) </span><span class="s3"># T = transpose</span>
            <span class="s1">print</span><span class="s2">(</span><span class="s5">'Best fitness value COST function (weight)='</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">gbest_cost</span><span class="s2">)</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s4">1</span><span class="s2">)</span>
            <span class="s1">Plot</span><span class="s2">(</span><span class="s1">nodes_original</span><span class="s2">, </span><span class="s1">Design_var</span><span class="s2">, </span><span class="s1">d</span><span class="s2">, </span><span class="s1">d1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s5">'gray'</span><span class="s2">, </span><span class="s5">'--'</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s5">'Original design'</span><span class="s2">)</span>
            <span class="s1">Plot</span><span class="s2">(</span><span class="s1">nodes</span><span class="s2">, </span><span class="s1">Design_var</span><span class="s2">, </span><span class="s1">d</span><span class="s2">, </span><span class="s1">d1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s5">'red'</span><span class="s2">, </span><span class="s5">'-'</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s5">'Optimal design'</span><span class="s2">)</span>


    <span class="s1">a </span><span class="s2">= </span><span class="s1">Particle</span><span class="s2">()</span>
    <span class="s1">a</span><span class="s2">.</span><span class="s1">Evaluate</span><span class="s2">()</span>
    <span class="s1">a</span><span class="s2">.</span><span class="s1">Plot</span><span class="s2">()</span>



<span class="s3">#  Run optimization</span>
<span class="s1">optimization</span><span class="s2">()</span>
<span class="s1">plt</span><span class="s2">.</span><span class="s1">show</span><span class="s2">()</span></pre>
</body>
</html>